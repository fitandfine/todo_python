{% extends 'base.html' %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4">Tasks</h1>
    <div>
      <form class="d-flex" method="get" action="{{ url_for('index') }}">
        <select name="status" class="form-select form-select-sm me-2">
          <option value="">All status</option>
          <option value="todo" {% if selected_status == 'todo' %}selected{% endif %}>To do</option>
          <option value="doing" {% if selected_status == 'doing' %}selected{% endif %}>Doing</option>
          <option value="done" {% if selected_status == 'done' %}selected{% endif %}>Done</option>
        </select>

        <select name="tag" class="form-select form-select-sm me-2">
          <option value="">All tags</option>
          {% for t in tags %}
            <option value="{{ t }}" {% if selected_tag == t %}selected{% endif %}>{{ t }}</option>
          {% endfor %}
        </select>

        <button class="btn btn-sm btn-secondary">Filter</button>
      </form>
    </div>
  </div>

  {% if tasks %}
    <div class="row row-cols-1 row-cols-md-2 g-3">
      {% for task in tasks %}
        <div class="col">
          <div class="card h-100 task-card">
            <div class="card-body d-flex flex-column">
              <div class="d-flex justify-content-between">
                <h5 class="card-title mb-1">{{ task.title }}</h5>
                <small class="text-muted">{{ task.status }}</small>
              </div>

              {% if task.tag %}
                <p class="mb-1"><span class="badge bg-secondary">{{ task.tag }}</span></p>
              {% endif %}

              <p class="card-text small text-truncate">{{ task.description }}</p>

              <div class="mt-auto d-flex justify-content-between align-items-center">
                <div>
                  {% if task.due_date %}
                    <small class="text-muted">Due: {{ task.due_date }}</small>
                  {% endif %}
                </div>
                <div class="btn-group btn-group-sm" role="group">
                  <a class="btn btn-outline-primary" href="{{ url_for('edit_task', task_id=task.id) }}">Edit</a>
                  <a class="btn btn-outline-secondary" href="{{ url_for('toggle_task', task_id=task.id) }}">Toggle</a>
                  <a class="btn btn-outline-danger" href="{{ url_for('delete_task', task_id=task.id) }}">Delete</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No tasks yet. <a href="{{ url_for('create_task') }}">Create one</a>.</p>
  {% endif %}
{% endblock %}
